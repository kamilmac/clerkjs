var Clerk=function(){function t(t){var n=this;this._now=0,this.register=function(t){for(var i=0,r=n._admins.length;r>i;i+=1)if(n._admins[i].id==t)return console.log("Model: Duplicated admin."),!1;return n._admins.push({id:t,writes:0}),t},this.set=function(t,i){var r=n._get_admin(t);if(r)for(var e in i)n._save(e,i[e],t),r.writes++},this.undo=function(t){void 0===t&&(t=1),n._now=n._now-t,n._lets_dance()},this.redo=function(t){void 0===t&&(t=1),n._now=n._now+t,n._lets_dance()},this.bind=function(t,i){var r=0;for(var e in i)n.get(e,t+"_"+r++,i[e])},this.get=function(t,i,r){if(void 0===i&&(i=""),t=t.split("."),!r||!i)return n._getOnce(t);var e=t.join(".")+i;n._duplicatedListener(e)||n._listeners.push({prop:t,callback:r,id:e}),r(n._getOnce(t))}}return t.prototype._save=function(t,n,i,r){void 0===r&&(r=!1),t=t.split(".");for(var e=this.$app_data,o=null,s=0,_=t.length;_>s;s+=1){if("undefined"==typeof e[t[s]])return!1;s==_-1?(o=e[t[s]],e[t[s]]=n):e=e[t[s]]}r||(this._history.push({old_val:o,prop:t,invalidatedBy:i}),this._now++),this._notify(t)},t.prototype._notify=function(t){for(var n=0,i=this._listeners.length;i>n;n+=1){var r=this._listeners[n];this._mark_for_change(r.prop,t)&&r.callback(this._getOnce(r.prop))}},t.prototype._mark_for_change=function(t,n){if(t[0]!=n[0])return!1;var i=null;i=t.length>n.length?n.length:t.length;for(var r=1;i>r;r+=1)if(t[r]!=n[r])return!1;return!0},t.prototype._duplicatedListener=function(t){for(var n=0,i=this._listeners;n<i.length;n++){var r=i[n];if(t==r.id)return!0}return!1},t.prototype._getOnce=function(t){for(var n=this.$app_data,i=0;i<t.length;i++){var r=t[i];if("undefined"==typeof n[r])return;n=n[r]}return n},t.prototype._lets_dance=function(){this._now>=this._history.length?this._now=this._history.length:this._now<0&&(this._now=0);var t=this._history[this._now];this._save(t.prop,t.old_val,!0)},t.prototype._get_admin=function(t){for(var n=0,i=this._admins.length;i>n;n+=1)if(this._admins[n].id==t)return this._admins[n];return!1},t}();