var Clerk=function(){function t(t){var n=this;this._listeners=[],this._clerks=[],this._history=[],this._now=0,this.$app_data={},this.registerClerk=function(t){for(var e=0,i=n._clerks.length;i>e;e+=1)if(n._clerks[e].id==t)return console.log("Model: Duplicated clerk."),!1;return n._clerks.push({id:t,writes:0}),t},this.set=function(t,e){var i=n._get_admin(t);if(i)for(var r in e)n._save(r,e[r],t),i.writes++},this.undo=function(t){void 0===t&&(t=1),n._now=n._now-t,console.log("undo now: ",n._now),n._lets_dance()},this.redo=function(t){void 0===t&&(t=1),n._now=n._now+t,console.log("redo now: ",n._now),n._lets_dance()},this.bind=function(t,e){var i=0;for(var r in e)n.get(r,t+"_"+i++,e[r])},this.get=function(t,e,i){if(void 0===e&&(e=""),t=t.split("."),!i||!e)return n._getOnce(t);var r=t.join(".")+e;n._duplicatedListener(r)||n._listeners.push({prop:t,callback:i,id:r}),i(n._getOnce(t))},this.$app_data=t||{}}return t.prototype._save=function(t,n,e,i){void 0===i&&(i=!1),t=t.split(".");for(var r=this.$app_data,o=null,s=0,_=t.length;_>s;s+=1){if("undefined"==typeof r[t[s]])return!1;s==_-1?(o=r[t[s]],r[t[s]]=n):r=r[t[s]]}i||(this._history.push({old_val:o,new_val:n,prop:t,invalidatedBy:e}),this._now++),this._notify(t)},t.prototype._notify=function(t){for(var n=0,e=this._listeners.length;e>n;n+=1){var i=this._listeners[n];this._mark_for_change(i.prop,t)&&i.callback(this._getOnce(i.prop))}},t.prototype._mark_for_change=function(t,n){if(t[0]!=n[0])return!1;var e=null;e=t.length>n.length?n.length:t.length;for(var i=1;e>i;i+=1)if(t[i]!=n[i])return!1;return!0},t.prototype._duplicatedListener=function(t){for(var n=0,e=this._listeners;n<e.length;n++){var i=e[n];if(t==i.id)return!0}return!1},t.prototype._getOnce=function(t){for(var n=this.$app_data,e=0;e<t.length;e++){var i=t[e];if("undefined"==typeof n[i])return;n=n[i]}return n},t.prototype._lets_dance=function(){this._now>=this._history.length?this._now=this._history.length:this._now<0&&(this._now=0),console.log("state: ",this._history);var t=this._history[this._now];this._save(t.prop.join("."),t.old_val,!1,!0)},t.prototype._get_admin=function(t){for(var n=0,e=this._clerks.length;e>n;n+=1)if(this._clerks[n].id==t)return this._clerks[n];return!1},t}();